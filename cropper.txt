// ======================================================================
/*!

\mainpage Cropper

\section cropper_intro Johdanto

Animaatioiden tekemisessä tarvitaan kuvien croppausta lennosta.  Tähän
tarkoitukseen voisi käyttää ImageMagick paketin \c convert käskyä,
mutta ImageMagick on todettu turhan epästabiiliksi. Näin ollen
käytämme lokaalia varta vasten tähän tarkoitukseen tehtyä ohjelmaa.

Lisähyötynä on mahdollisuus säätää tarkasti cropperin toimintaa,
esim.

  -# cachettaa tuloksia automaattisesti
  -# cropata keskipisteen suhteen kulmapisteen sijaan
  -# hyödyntää paikkatietokantaa

\section cropper_optiot Komentorivioptiot

<p>
Komentorivioptiot ovat
<dl>
<dt>-f [kuvatiedosto]</dt>
<dd>Kuvatiedoston nimi</dd>
<dt>-g [kulmageometria]</dt>
<dd>Cropattavan alueen koko ja kulmapiste.
<dt>-c [keskigeometria]</dt>
<dd>Cropattavan alueen koko ja keskipiste.
<dt>-p [nimigeometria]</dt>
<dd>Cropattavan alueen koko ja keskipisteen ja kartan nimi.
<dt>-l [latlongeometria]</dt>
<dd>Cropattavan alueen koko, keskipisteen koordinaatit ja kartan nimi.
<dt>-o [tiedostonimi]</dt>
<dd>Optionaalinen tiedostonimi</dd>
<dt>-C</dt>
<dd>Tulosta ei talleteta cacheen, eikä sitä myöskään lueta sieltä.</dd>
</dl>
</p>

<p>
Jos yhtäkään optioiosta -g, -c, -p tai -l ei ole annettu, palautetaan
haluttu kuva sellaisenaan.
</p>

<p>
Jos tiedostonimiargumenttia ei ole annettu, tulostetaan kuva aina
suoraan terminaalille sopivien HTTP-headerien kera. Kuvat oletetaan
staattisiksi (eli käytännössä nimissä lienee aikaleima kuvien
erottelemiseksi). Näin ollen kuvien ilmoitetaan olevan aina voimassa,
ne eivät koskaan muutu eivätkä ekspiroidu.
</p>

\section cropper_querystring QUERYSTRING optiot

<p>
Jos ympäristömuuttuja \c QUERYSTRING on asetettu, oletetaan
ohjelmaa ajettavan cgi-binäärinä, ja optiot parseroidaan
komentorivin sijaan \c QUERYSTRING muuttujasta.
</p>
<p>
Koko \c QUERYSTRING oletetaan cryptatuksi php:n palcrypt käskyllä!
</p>
<p>
\c QUERYSTRING muuttujasta tunnistetaan komentorivioptioita
vastaavat muuttujat, eli C, f, g, c, p ja l, mutta ei optiota o.
Ylimääräiset muuttujat jätetään huomioimatta ilman virheilmoitusta.
</p>

\section cropper_kulmat Croppaus kulmapisteiden suhteen

Optiolle \c -g annettavan \c [kulmageometria] argumentin syntaksi on
\code
<width>x<height>+<x1>+<y1>
\endcode
Cropattava alue on tällöin

  - Vasen yläkulma: (x1,y1)
  - Oikea alakulma: (x2,y2) = (x1,y1) + (width,height)

\section cropper_keskipiste Croppaus keskipisteen suhteen

Optiolle \c -c annettavan \c [keskigeometria] argumentin syntaksi on
\code
<width>x<height>+<xc>+<yc>
\endcode
missä (xc,yc) on haluttu keskipiste. Cropattavan alue on tällöin

  - Vasen yläkulma (x1,y1) = (xc-width/2,yc-width/2)
  - Oikea alakulma (x2,y2) = (x1,y1) + (width,height)

\section cropper_nimetty Croppaus koordinaattitpisteen suhteen

Optiolle \c -l annettavan \c [latlongeometria] argumentin syntaksi on
\code
<width>x<height>+<lon>+<lat>:<karttanimi>
\endcode
Keskipisteen koordinaatti määräytyy suoraan annettujen longitudin,
latitudin perusteella ja karttanimen perusteella. Tämän jälkeen
cropattava alue määräytyy kuten kappaleessa \ref cropper_keskipiste

\section cropper_nimetty Croppaus nimetyn pisteen suhteen

Optiolle \c -p annettavan \c [nimigeometria] argumentin syntaksi on
\code
<width>x<height>+<paikannimi>:<karttanimi>
\endcode
Keskipisteen koordinaatti lasketaan tietokannasta haettavan paikannimen
ja karttanimen perusteella. Tämän jälkeen cropattava alue määräytyy
kuten kappaleessa \ref cropper_keskipiste

\section cropper_kartat Tietokantamäärittelyt

Tietokannat on toistaiseksi toteutettu tiedostopohjaisina.
Paikkakuntien nimet on tallennettu tiedostoon
\code
/data/share/coordinates/kaikki.txt
\endcode
Jos kartan nimi on \c tyyli/alue haetaan kartan määrittelyt
tiedostosta
\code
/data/share/maps/tyyli/alue/alue.cnf
\endcode

\section cropper_kuvaformaatit Kuvaformaatit

Toistaiseksi tuetaan vain PNG-kuvaformaattia.

\section cropper_cache Cache

Cachea käytetään vain, kun kuvat haetaan HTTP-protokollan kautta. Tällöin
käytetään cache-hakemistoa /tmp/cropper, jonka olemassaolon cropper itse
varmistaa aina tarvittaessa. Kukin cropattu kuva cachetetaan nimellä,
joka muodostetaan \c QUERY_STRING muuttujasta korvaamalla ei-alfanumeerinen
merkki heksadesimaalisella vastineellaan.

*/
// ======================================================================
